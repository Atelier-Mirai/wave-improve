<!--【JavaScript・CSS】スクロールしたらフワッと要素を表示させるスクリプト--><!--http://noze.space/archives/415-->
<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>スクロールでフワッと要素表示</title>

  <style>
    header {
      margin-bottom: 50px;
    }

    /* グリッドレイアウトで、div要素を配置する */
    section {
      display: grid;
      /* grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); */
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
    }
    div {
      font-size: 24px; text-align: center;
    }

    /* sa(スクロールアニメーション)用のクラス指定 */
    .sa {
      background: #c0f4c7;
      height: 200px;
    }
    .sa {
      opacity: 0;
      transition: all .5s ease;
    }
    .sa.show {
      opacity: 1;
      transform: none;
    }
    .ltr        { transform: translate(-100px, 0); }
    .rtl        { transform: translate(100px, 0); }
    .up         { transform: translate(0, 100px); }
    .down       { transform: translate(0, -100px); }
    .scale_up   { transform: scale(.5); }
    .scale_down { transform: scale(1.5); }
    .rotate_l   { transform: rotate(180deg); }
    .rotate_r   { transform: rotate(-180deg); }
  </style>
</head>

<body>

  <nav class="nav">
    <ul>
      <li><a href="index.html">トップに戻る</a></li>
    </ul>
  </nav>

  <h1>スクロールしたらフワッと要素を表示させるスクリプト</h1>
  <a href="http://noze.space/archives/415">http://noze.space/archives/415 より</a>

<section>
  <div class="sa up">
    要素1<br>sa up
  </div>
  <div class="sa up" data-sa_delay="200">
    要素2<br>sa up<br>200
  </div>
  <div class="sa up" data-sa_delay="400">
    要素3<br>sa up<br>400
  </div>
  <div class="sa up" data-sa_delay="600">
    要素4<br>sa up<br>600
  </div>
  <div class="sa up" data-sa_delay="600">
    要素5<br>sa up<br>600
  </div>
  <div class="sa up" data-sa_delay="400">
    要素6<br>sa up<br>400
  </div>
  <div class="sa up" data-sa_delay="200">
    要素7<br>sa up<br>200
  </div>
  <div class="sa up">
    要素8<br>sa up
  </div>
  <div class="sa ltr" id="elem9">
    要素9<br>sa ltr<br>#elem9
  </div>
  <div class="sa rtl">
    要素10<br>sa rtl
  </div>
  <div class="sa up" data-sa_trigger="#elem9">
    要素11<br>sa up<br>#elem9
  </div>
  <div class="sa down" data-sa_trigger="#elem9">
    要素12<br>sa down<br>#elem9
  </div>
  <div class="sa scale_up" data-sa_trigger="#elem15">
    要素13<br>sa scale_up<br>#elem15
  </div>
  <div class="sa scale_down" data-sa_trigger="#elem15 ">
    要素14<br>sa scale_down<br>#elem15
  </div>
  <div class="sa rotate_l" id="elem15">
    要素15<br>sa ratate_l<br>#elem15
  </div>
  <div class="sa rotate_r">
    要素16<br>sa ratate_r
  </div>
</section>


<script>
  const scroll_animation_class      = 'sa';
  const scroll_animation_show_class = 'show';
  const trigger_margin_dafault      = 300;

  let scroll_animation_elements = document.querySelectorAll(`.${scroll_animation_class}`);

  let scroll_animation_function = function () {
    // 表示タイミング位置を指定
    // 例) data-sa_margin="200"
    // その要素が画面の下から200px上に上がって来たら表示する
    let data_margin  = `${scroll_animation_class}_margin`;
    // 表示タイミングの基準の要素を指定
    // 例) data-sa_trigger="#elem1"
    // #elem1の出現と同時に、その要素も表示させる
    let data_trigger = `${scroll_animation_class}_trigger`;
    // 表示タイミング時間を指定
    // 例) data-sa_delay="500"
    // 500ms 後にその要素を表示する
    let data_delay   = `${scroll_animation_class}_delay`;

    // saクラスの要素を対象に処理を行う
    for(let i = 0; i < scroll_animation_elements.length; i++){
      let elm = scroll_animation_elements[i];

      // もしdata-sa_marginに値があれば、その数値に置き換える
      let trigger_margin = trigger_margin_dafault;
      if (elm.dataset[data_margin] != null) {
        trigger_margin = parseInt(elm.dataset[data_margin]);
      }

      // data-sa_trigger属性に値があれば指定の要素、無ければその要素自身の位置を判定基準にする
      let show_position = 0;
      if (elm.dataset[data_trigger]) {
        show_position = document.querySelector(elm.dataset[data_trigger]).getBoundingClientRect().top + trigger_margin;
      } else {
        show_position = elm.getBoundingClientRect().top + trigger_margin;
      }

      // data-sa_delay があれば、その時間だけずらして表示する。
      if (window.innerHeight > show_position) {
        let delay = (elm.dataset[data_delay]) ? elm.dataset[data_delay] : 0;
        setTimeout(function(index) {
          scroll_animation_elements[index].classList.add(scroll_animation_show_class);
        }.bind(null, i), delay);
      }
    }
  }

  // イベントリスナ
  window.addEventListener('load', scroll_animation_function);
  window.addEventListener('scroll', scroll_animation_function);
</script>

</body>
</html>
