<!DOCTYPE html>
<html lang="ja"></html>
<head>
  <meta charset="UTF-8" />
  <title>レーダーチャート</title>

  <!-- 簡単に見栄えの良いページを作るためのスタイルシート -->
  <link rel="stylesheet" href="https://unpkg.com/sakura.css/css/sakura.css">

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
</head>

<body>
  <header>
    <h1>レーダーチャート</h1>
  </header>

  <div>
    <canvas id="myChart"></canvas>
  </div>

  <div>
    <button id="randomizeData">ランダムデータ</button>
    <button id="addDataset">データセットの追加</button>
    <button id="removeDataset">データセットの削除</button>
    <button id="addData">データの追加</button>
    <button id="removeData">データの削除</button>
  </div>

  <script>
    // 色の設定
    const colorSet = {
      red   : '#ff6384',
      orange: '#ff9f40',
      yellow: '#ffcd55',
      green : '#4bc1c1',
      blue  : '#36a2eb',
      purple: '#9966ff',
      grey  : '#c8cacf'
    }

    // 色のRGB変換
    const color = Chart.helpers.color

    // 乱数生成(0～100)
    const rnd100 = () => {
      return Math.round(Math.random() * 100)
    }

    // チャートの初期設定
    let config = {
      type: 'radar',
      data: {
        labels: ["月曜", "火曜", "水曜", "木曜", "金曜", "土曜", "日曜"],
        datasets: [
          {
            label: "運動量",
            backgroundColor: color(colorSet.red).alpha(0.5).rgbString(),
            borderColor: colorSet.red,
            pointBackgroundColor: colorSet.red,
            data: [40, 50, 60, 70, 80, 90, 100]
          },
          {
            label: "摂取量",
            backgroundColor: color(colorSet.blue).alpha(0.5).rgbString(),
            borderColor: colorSet.blue,
            pointBackgroundColor: colorSet.blue,
            data: [100, 90, 80, 70, 60, 50, 40]
          }
        ]
      },
      options: {
        animation: false,
        showTooltips: false,
        legend: { position: 'bottom' },
        title: {
          display: true,
          fontSize: 20,
          fontColor:'#666',
          text: '一週間チャート'
        },
        scale: {
          display: true,
          pointLabels: {
            fontSize: 15,
            fontColor: colorSet.yellow
          },
          ticks: {
            display: true,
            fontSize: 12,
            fontColor: colorSet.green,
            min: 0,
            max: 100,
            beginAtZero: true
          },
          gridLines: {
            display: true,
            color: colorSet.yellow
          }
        }
      }
    }

    // チャートの作成
    let myRadar = new Chart($("#myChart"), config)

    // ランダムデータ（#randomizeData）
    $("#randomizeData").on('click', () => {
      alert('aa')
      config.data.datasets.forEach((dataset) => {
        dataset.data = dataset.data.map(() => {
          return rnd100()
        })
      })
      myRadar.update()
    })
    let colorNames = Object.keys(colorSet);

    // データセットの追加（#addDataset）
    $("#addDataset").on('click', () => {
      let colorName = colorNames[config.data.datasets.length % colorNames.length]
      let newColor = colorSet[colorName]
      let newDataset = {
        label: 'Dataset ' + config.data.datasets.length,
        borderColor: newColor,
        backgroundColor: color(newColor).alpha(0.2).rgbString(),
        pointBorderColor: newColor,
        data: [],
      }
      for (let index = 0; index < config.data.labels.length; ++index) {
        newDataset.data.push(rnd100())
      }
      config.data.datasets.push(newDataset)
      myRadar.update()
    })

    // データの追加（#addData）
    $("#addData").on('click', () => {
      if (config.data.datasets.length > 0){
        config.data.labels.push('dataset #' + config.data.labels.length)
        config.data.datasets.forEach((dataset) => {
          dataset.data.push(rnd100())
        })
        myRadar.update();
      }
    })

    // データセットの削除（#removeDataset）
    $("#removeDataset").on('click', () => {
      config.data.datasets.splice(0, 1)
      myRadar.update()
    })

    // データの削除（#removeData）
    $("#removeData").on('click', () => {
      config.data.labels.pop() // remove the label first
      config.data.datasets.forEach((dataset) => {
        dataset.data.pop()
      })
      myRadar.update()
    })
  </script>

  <footer>
    <p>
      参考: <a href="https://www.chartjs.org">Chart.js</a>
    </p>
  </footer>
</body>
